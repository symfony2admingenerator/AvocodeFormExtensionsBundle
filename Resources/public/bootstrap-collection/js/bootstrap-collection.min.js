(function(e,t,n){function o(t,n){this.element=t;this.$element=e("#"+t.id);this.options=e.extend({},s,n);this._defaults=s;this._name=r;this._init()}var r="bootstrapCollection",i=t.document,s={allow_add:false,allow_delete:false,sortable:false,sortable_field:"position",prototype_name:"__name__",trans:{new_label:"New item",confirm:"Are you sure you want to delete this element?",confirm_batch:"Are you sure you want to delete all selected elements?"},javascript:function(e){}};o.prototype={_init:function(){var t=this;if(this.options.allow_add){this.$new=e("#"+this.element.id+"_toolbar > .new");this.nextId=this.$element.children(" .collection > .collection-item").length;this.$new.on("click",function(n){n.preventDefault();var r=e.Event("adding");t.$element.trigger(r);if(!r.isDefaultPrevented()){t._onAdd();t.$element.trigger("added")}})}if(this.options.allow_delete){e("."+this.element.id+"_actions .delete").click(function(n){n.preventDefault();var r=e.Event("deleting");var i=e(this).closest(".collection-item");t.$element.trigger(r,[i]);if(!r.isDefaultPrevented()){t._onDelete(this);t.$element.trigger("deleted",[i])}});this.$toggleAll=e("#"+this.element.id+'_toolbar > .btn-toggle > input[name="toggle"]');this.$toggleAll.on("change",function(e){t._onToggleAll()});e("#"+this.element.id+"_toolbar > .batch-delete").click(function(){var n=e.Event("deleting-all");t.$element.trigger(n);if(!n.isDefaultPrevented()){t._onDeleteAll();t.$element.trigger("deleted-all")}})}if(this.options.sortable){e("#"+this.element.id+" > .collection").sortable({update:function(e,n){t._onChange()},cancel:"a, button, img, input, textarea, select, iframe, .cke div, .cke span",start:function(n,r){t.ckeConfigs=[];e("textarea",r.item).each(function(){var n=e(this).attr("id");if(CKEDITOR.instances[n]){var r=e(this).next(".cke").clone().addClass("cloned");t.ckeConfigs[n]=CKEDITOR.instances[n].config;CKEDITOR.instances[n].destroy();e(this).hide().after(r)}})},stop:function(n,r){e("textarea",r.item).each(function(){var n=e(this).attr("id");if(t.ckeConfigs[n]){CKEDITOR.replace(n,t.ckeConfigs[n]);e(this).next(".cloned").remove()}})}})}},_onAdd:function(){var n=e("#"+this.element.id).data("prototype");var r=this.nextId;n=n.replace(new RegExp("label__","g"),this.options.trans.new_label);n=n.replace(new RegExp(this.options.prototype_name,"g"),r);$new_item=e(n);if(this.options.allow_delete){var i=this;$new_item.find(".delete").click(function(){var t=e.Event("deleting");var n=e(this).closest(".collection-item");i.$element.trigger(t,[n]);if(!t.isDefaultPrevented()){i._onDelete(this);i.$element.trigger("deleted",[n])}})}this.nextId++;e("#"+this.element.id+" > .collection").append($new_item);this.options.javascript.call(t,this.element.id+"_"+r);if(this.options.sortable){this._onChange()}},_onDelete:function(t){if(confirm(this.options.trans.confirm)){e(t).closest(".collection-item").remove();if(this.options.sortable){this._onChange()}}},_onChange:function(){e('[id^="'+this.element.id+'"][id$="'+this.options.sortable_field+'"]').each(function(t){e(this).val(t)})},_onToggleAll:function(){if(this.$toggleAll.is(":checked")){this.$toggleAll.prop("checked",true);e("."+this.element.id+'_actions > .btn-toggle > input[name="delete"]').prop("checked",true)}else{this.$toggleAll.prop("checked",false);e("."+this.element.id+'_actions > .btn-toggle > input[name="delete"]').prop("checked",false)}},_onDeleteAll:function(){if(confirm(this.options.trans.confirm_batch)){e("."+this.element.id+'_actions > .btn-toggle > input[name="delete"]:checked').each(function(){e(this).closest(".collection-item").remove()});if(this.options.sortable){this._onChange()}this.$toggleAll.prop("checked",false)}}};e.fn[r]=function(t){var i=arguments;if(t===n||typeof t==="object"){return this.each(function(){if(!e.data(this,"plugin_"+r)){e.data(this,"plugin_"+r,new o(this,t))}})}else if(typeof t==="string"&&t[0]!=="_"&&t!=="init"){var s;this.each(function(){var n=e.data(this,"plugin_"+r);if(n instanceof o&&typeof n[t]==="function"){s=n[t].apply(n,Array.prototype.slice.call(i,1))}if(t==="destroy"){e.data(this,"plugin_"+r,null)}});return s!==n?s:this}}})(jQuery,window)